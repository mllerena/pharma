<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:pr="http://primefacesreload.com/jsf/tags"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:o="http://omnifaces.org/ui">
	
	<pr:default var="rendered" value="true" />
	
	<pr:default var="renderedNew" value="true" />
	<pr:default var="renderedEdit" value="true" />
	<pr:default var="renderedSave" value="true" />
	<pr:default var="renderedDelete" value="true" />
	<pr:default var="renderedCancel" value="true" />
	<pr:default var="renderedProcess" value="false" />
	<pr:default var="renderedGenerate" value="false" />
	
	
	<pr:default var="labelNew" value="Nuevo" />
	<pr:default var="labelEdit" value="Editar" />
	<pr:default var="labelSave" value="Guardar" />
	<pr:default var="labelDelete" value="Eliminar" />
	<pr:default var="labelCancel" value="Cancelar" />
	<pr:default var="labelProcess" value="Procesar" />
	<pr:default var="labelGenerate" value="Generar" />
	
	<pr:default var="messageDelete" value="¿Está seguro de eliminar la selección de registro(s)?" />
	
	<pr:default var="editable" value="#{true}" />
	
	<pr:default var="rows" value="5" />
	
	

<style type="text/css">
.ui-toolbar-group-left{
	line-height: 25px;
}

.ui-toolbar-group-left > span{
	display: inline-block;
    vertical-align: middle;
    line-height: 1em; /*set line height back to normal*/
    margin-left: 2px;
}

 .rowEdited {
                background-color: #2191c0 !important;
                background-image: none !important;
                color: #ffffff !important;
            }

</style>


	<pr:context toolbarId="toolbar_#{id}" listId="list_#{id}" modalId="modal_#{id}"  data="#{dataList.dataTable}" >

		<h:panelGrid columns="1" id="#{id}" cellpadding="0" cellspacing="1" rendered="#{rendered}">
			<p:toolbar id="#{toolbarId}">
				<f:facet name="left">
					<span>#{title}</span>
				</f:facet>
				<f:facet name="right">

					<p:commandButton icon="ui-icon-plus" id="cbNew_#{id}" oncomplete="PF('wvEdit_#{modalId}').show();" process="@this" update="#{modalId} #{toolbarId} #{listId}"
							actionListener="#{dataList.actionCreate}" value="#{labelNew}" rendered="#{renderedNew}" disabled="#{not dataList.enabledCreate}"> 
							<f:actionListener type="org.omnifaces.eventlistener.ResetInputAjaxActionListener" />
							</p:commandButton>
							
					<p:commandButton icon="ui-icon-pencil" id="cbEdit_#{id}" oncomplete="PF('wvEdit_#{modalId}').show();" process="@this" update="#{modalId}"
							actionListener="#{dataList.actionEdit}" value="#{labelEdit}" rendered="#{not (empty data) and renderedEdit}" disabled="#{not dataList.enabledEdit}">
							<f:actionListener type="org.omnifaces.eventlistener.ResetInputAjaxActionListener" />
							</p:commandButton>
							
					<p:commandButton icon="ui-icon-disk" 
						id="cbSave_#{id}" process="@this" update="#{toolbarId} #{listId}"
							actionListener="#{dataList.actionMultiSave}"  value="#{labelSave}" rendered="#{not (empty data) and renderedSave}" disabled="#{not dataList.enabledSave}">
							</p:commandButton>				

					<p:commandButton icon="ui-icon-trash" 
						id="cbDelete_#{id}" process="@this" update="#{toolbarId} #{listId}"
							actionListener="#{dataList.actionDelete}" value="#{labelDelete}" rendered="#{not (empty data) and renderedDelete}" disabled="#{not dataList.enabledDelete}"> 
							<p:confirm header="Confirmación" message="#{messageDelete}"
									icon="ui-icon-alert"  />
							</p:commandButton>

					

					<p:commandButton icon="ui-icon-cancel" 
							process="@this" update="#{toolbarId} #{listId}"
							actionListener="#{dataList.actionCancel}" disabled="#{not dataList.enabledCancel}"
						id="cbCancel_#{id}" rendered="#{not (empty data) and renderedCancel}" value="#{labelCancel}">
						</p:commandButton>
						
					<p:commandButton icon="ui-icon-check" 
					process="@this" 
							actionListener="#{dataList.actionProcess}"
						id="cbProcess_#{id}" rendered="#{not (empty data) and renderedProcess}" value="#{labelProcess}" disabled="#{not dataList.enabledProcess}">
						</p:commandButton>	
						
					<p:commandButton icon="ui-icon-transferthick-e-w"
						process="@this" update="#{toolbarId} #{listId}"
							actionListener="#{dataList.actionGenerate}"
						id="cbGenerate_#{id}" rendered="#{not (empty data) and renderedGenerate}" value="#{labelGenerate}" disabled="#{not dataList.enabledGenerate}"> 
						</p:commandButton>
					
					<ui:insert name="extraButtons" />
					
							

				</f:facet>

			</p:toolbar>

			<pr:dataTable id="#{listId}" dataTable="#{data}" selectedRecords="#{dataList.rowSelectCountTotal}" totalRecords="#{dataList.rowCountTotal}" totalModified="#{dataList.rowModifiedCountTotal}"
				rowKey="#{rowKey}"  selectionMode="multiple"  
				selection="#{dataList.selectItems}" editable="#{editable}" rowStyleClass="#{row.change? 'rowEdited' : null}" rows="#{rows}"  >
				<p:column headerText="" style="width:16px;text-align:center" >
					<h:panelGroup rendered="#{row.change}" style="padding:0px;spacing:0px;">
					<img src="../resources/images/pencil.png" />
					</h:panelGroup>
				</p:column>
				<pr:context header="">
					<ui:insert />
				</pr:context> 
				<ui:define name="events">
					<p:ajax event="toggleSelect" listener="#{dataList.onRowSelect()}" process="#{listId}" update="@parent:#{toolbarId} #{listId}"/>
					
					<p:ajax event="rowSelectCheckbox" listener="#{dataList.onRowSelect()}" process="#{listId}"  update="@parent:#{toolbarId} #{listId}"/> 
					<p:ajax event="rowUnselectCheckbox" listener="#{dataList.onRowUnselect()}" process="#{listId}" update="@parent:#{toolbarId} #{listId}"/>
       				
       				<p:ajax event="cellEdit" listener="#{dataList.onCellEdit(row,listId)}" ignoreAutoUpdate="true" process="@this" />     
					
				</ui:define> 
				
				
			</pr:dataTable>
			
			<p:remoteCommand name="onCellEditEvent#{listId}" update="@parent:#{toolbarId} #{listId}" process="@parent:#{toolbarId} #{listId}"></p:remoteCommand>    
			
			<h:outputScript>
			
			function handleEdit(xhr, status, args) {
				console.log("args.warn: "+args.warn);
		        if(!args.warn) {
		            PF('wvNew_#{modalId}').show();
		        }
		    }
			
			</h:outputScript>
			
			
		</h:panelGrid>




	</pr:context>




</ui:composition>